<div class="flex flex-col items-center w-[14.6rem] h-full gap-6 bg-[#002752]" tabindex="0">

    <!-- Logo Section -->
    <button class="px-4 pt-4" (click)="onLogoClick()">
        <img src="../../../assets/images/Logo.svg" alt="Logo">
    </button>

    <!-- Sidebar Items Container -->
    <div class="flex flex-col gap-4 overflow-y-auto overflow-x-hidden
            [&::-webkit-scrollbar]:w-0
            [&::-webkit-scrollbar-track]:bg-transparent
            [&::-webkit-scrollbar-thumb]:bg-gray-300
            [&::-webkit-scrollbar-thumb]:rounded-full
            hover:[&::-webkit-scrollbar-thumb]:bg-gray-400">

        <!-- Sidebar Items -->
        <ng-container *ngFor="let item of SidebarItems">
            <!-- Normal Mode or Special Items -->
            <ng-container *ngIf="!editMode && !deleteMode || item.linkId === -1 || item.name.toLowerCase() === 'spare'">
                <app-side-button [iconName]="item.icon" [content]="item.name"
                    [activeState]="isSideBarActive ? item.activeState : false" [isSideBarActive]="isSideBarActive"
                    (buttonClicked)="onSideButtonClick(item)" />
            </ng-container>
            <!-- Edit Mode Items -->
            <ng-container *ngIf="editMode && item.linkId !== -1 && item.name.toLowerCase() !== 'spare'">
                <div class="flex items-center gap-2 w-full">
                    <input type="text" [(ngModel)]="editLocationNames[item.linkId]"
                        (keydown)="onEditLocationInputKeydown($event)"
                        class="rounded bg-[#002752] border border-gray-600 px-3 py-2 text-white placeholder-gray-300 shadow focus:outline-none focus:border-yellow-400" />
                    <lucide-icon name="Diamond" size="20" color="white"></lucide-icon>
                </div>
            </ng-container>
            <!-- Delete Mode Items (same layout as edit mode, but with trash icon) -->
            <ng-container *ngIf="deleteMode && item.linkId !== -1 && item.name.toLowerCase() !== 'spare'">
                <div class="flex items-center gap-2 w-full">
                    <div class="flex-1 rounded bg-[#002752] border border-gray-600 px-3 py-2 text-white font-medium">
                        {{item.name}}</div>
                    <button (click)="onDeleteIconClick(item)" class="hover:bg-red-100 rounded-full p-1">
                        <lucide-icon name="trash-2" [size]="24" color="#c71509"></lucide-icon>
                    </button>
                </div>
            </ng-container>
        </ng-container>

        <!-- Add Location Input -->
        <div *ngIf="showAddLocationInput" class="flex justify-center pb-2 gap-2 items-center">
            <input id="add-location-input" type="text" [(ngModel)]="newLocationName"
                (keydown)="onAddLocationInputKeydown($event)" placeholder="Enter location name"
                class="rounded bg-[#002752] border border-gray-600 px-3 py-2 text-white placeholder-gray-300 shadow focus:outline-none focus:border-green-400" />
        </div>

    </div>

    <!-- Action Buttons -->
    <div class="flex w-full py-4 mt-auto justify-around">
        <!-- Add Location Button -->
        <button *ngIf="!editMode && !showAddLocationInput && !deleteMode" class="hover:bg-green-400 rounded-full p-2"
            (click)="onAddLocationIconClick()">
            <lucide-icon name="plus" size="24" color="white"></lucide-icon>
        </button>
        <!-- Edit Mode Toggle -->
        <button *ngIf="!editMode && !showAddLocationInput && !deleteMode" class="hover:bg-yellow-400 rounded-full p-2"
            (click)="onEditModeClick()">
            <lucide-icon name="Pencil" size="24" color="white"></lucide-icon>
        </button>
        <!-- Edit Mode Actions -->
        <div *ngIf="editMode" class="flex gap-14">
            <button class="hover:bg-green-500 bg-green-600 rounded-full p-2" (click)="onEditConfirmClick()">
                <lucide-icon name="check" size="24" color="white"></lucide-icon>
            </button>
            <button class="hover:bg-red-500 bg-red-600 rounded-full p-2" (click)="onEditCancelClick()">
                <lucide-icon name="x" size="24" color="white"></lucide-icon>
            </button>
        </div>
        <!-- Add Location Actions (bottom, like edit mode) -->
        <div *ngIf="showAddLocationInput" class="flex gap-14">
            <button class="hover:bg-green-500 bg-green-600 rounded-full p-2" (click)="onAddLocationConfirmClick()">
                <lucide-icon name="check" size="24" color="white"></lucide-icon>
            </button>
            <button class="hover:bg-red-500 bg-red-600 rounded-full p-2" (click)="onAddLocationCancelClick()">
                <lucide-icon name="x" size="24" color="white"></lucide-icon>
            </button>
        </div>
        <!-- Delete Button -->
        <button *ngIf="!editMode && !showAddLocationInput && !deleteMode" class="hover:bg-red-400 rounded-full p-2"
            (click)="onDeleteModeClick()">
            <lucide-icon name="trash-2" size="24" color="white"></lucide-icon>
        </button>
        <!-- Delete Mode Actions (only cancel button, like edit mode) -->
        <div *ngIf="deleteMode" class="flex gap-14">
            <button class="hover:bg-red-500 bg-red-600 rounded-full p-2" (click)="onDeleteCancelClick()">
                <lucide-icon name="x" size="24" color="white"></lucide-icon>
            </button>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div *ngIf="showDeleteModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40">
        <div class="bg-white rounded-lg shadow-lg p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-[#c71509]">
                    Supprimer l'emplacement ?
                </h2>
                <button
                    class="text-gray-400 hover:bg-red-100 hover:text-red-600 transition-colors rounded-full p-1 focus:outline-none focus:ring-2 focus:ring-red-600"
                    (click)="closeDeleteModal()" aria-label="Fermer">
                    <lucide-icon name="x" [size]="25" />
                </button>
            </div>
            <div class="font-medium text-gray-800 mb-4">Voulez-vous vraiment supprimer <span
                    class="font-bold text-[#c71509]">{{locationToDelete?.name}}</span> ?</div>
            <div class="flex items-center text-sm text-[#024a97] bg-blue-50 rounded px-2 py-1 mb-4">
                <lucide-icon name="info" [size]="25" class="mr-2" />
                <span>Si des machines sont associées à cet emplacement, elles seront déplacées automatiquement vers
                    <span class="font-bold">SPARE</span>.</span>
            </div>
            <div class="flex justify-end gap-2">
                <button class="px-3 py-1.5 rounded-lg bg-gray-200 hover:bg-gray-300" (click)="closeDeleteModal()">
                    Annuler
                </button>
                <button class="px-3 py-1.5 rounded-lg bg-[#c71509] text-white hover:bg-[#a31207]"
                    (click)="confirmDeleteLocation()">
                    Supprimer
                </button>
            </div>
        </div>
    </div>
</div>