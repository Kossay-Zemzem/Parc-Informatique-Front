<div class="flex flex-row gap-0 bg-[#EAF5FE] rounded-lg overflow-hidden w-full max-w-full">
    <div class="grid grid-cols-6 w-1/3 min-w-0 items-center justify-center p-4 overflow-hidden">
        <div class="col-span-6 border-0 border-red-400">
            <div class="bg-[#003863] text-sm text-white w-fit px-2 py-1 rounded-lg shadow-lg font-medium">
                {{machine.type}}
            </div>
        </div>
        <!--       <div class="flex flex-col col-span-2 w-full border-0 border-red-400">
            <img class="w-20" src="../../../../../assets/images/desktop_low.png">
        </div> -->
        <!--------------------------------------------------------------------------------------------->
        <div class="flex flex-col col-span-2 w-full border-0 border-red-400">
            <ng-container [ngSwitch]="machine.type.toLowerCase()">
                <img *ngSwitchCase="'desktop'" class="w-20" src="../../../../../assets/images/desktop_low.png"
                    alt="Desktop" />
                <img *ngSwitchCase="'laptop'" class="w-20" src="../../../../../assets/images/Laptop_low.png"
                    alt="Laptop" />
                <img *ngSwitchCase="'workstation'" class="w-20" src="../../../../../assets/images/workstation_low.png"
                    alt="Workstation" />
                <img *ngSwitchDefault class="w-20" src="../../../../../assets/images/web-icon-placeholder-3.svg"
                    alt="Default" />
            </ng-container>
        </div>
        <div class="flex flex-col col-span-4 gap-1 h-full border-0 border-red-400 min-w-0">
            <div class="flex flex-row font-semibold justify-between items-center min-w-0">
                <div class="flex min-w-0 truncate">{{machine.marque | uppercase}}</div>
                <div class="flex flex-col text-right min-w-0 truncate">{{machine.reseau}}</div>
            </div>
            <div class="text-3xl font-semibold min-w-0 truncate">{{machine.modele}}</div>
            <div class="font-bold min-w-0 truncate">{{machine.serviceTag}}</div>
        </div>

        <!--------------------------------------------------------------------------------------------->
        <!--         <div class="flex flex-col col-span-2 h-full border-0 border-red-400 items-end text-right font-bold">
            {{machine.reseau}}
        </div> -->
        <div class="col-span-6 border-0 border-red-400 min-w-0">
            <div class="flex flex-row gap-2 items-center min-w-0">
                <lucide-icon name="user" class="text-[#003863] w-4" />
                <div class="flex flex-row gap-1 min-w-0 truncate"><span class="font-semibold">Assigné
                        à:</span>{{machine.assignedUser}}</div>
            </div>
            <div class="flex flex-row gap-2 items-center min-w-0">
                <lucide-icon name="map-pin" class="text-red-600 w-4" />
                <div class="flex flex-row gap-1 font-semibold min-w-0 truncate">{{machine.locationName}}</div>
            </div>
        </div>
    </div>
    <div class="w-0.5 my-2 bg-[#B7CBDB] rounded-full "></div>
    <div class="flex flex-col gap-2 w-1/3 min-w-0 pt-10 px-4 pb-4 overflow-hidden">
        <div class="flex flex-row gap-2 items-center min-w-0">
            <!--  <lucide-icon name="Users" class="text-[#003863] w-4" /> -->
            <div class="flex flex-row gap-1 min-w-0 truncate"><span class="font-semibold">OS:</span>{{machine.os}}</div>
        </div>
        <div class="flex flex-row gap-2 items-center min-w-0">
            <!-- <lucide-icon name="Users" class="text-[#003863] w-4" /> -->
            <div class="flex flex-row gap-1 min-w-0 truncate"><span class="font-semibold">CPU:</span>{{machine.cpu}}
            </div>
        </div>
        <div class="flex flex-row gap-2 items-center min-w-0">
            <!-- <lucide-icon name="Users" class="text-[#003863] w-4" /> -->
            <div class="flex flex-row gap-1 min-w-0 truncate">
                <span class="font-semibold">RAM:</span>
                <ng-container *ngIf="machine.ram !== undefined && machine.ram !== null; else noRam">
                    {{machine.ram}} Go
                </ng-container>
                <ng-template #noRam>
                    <span class="text-gray-400">Non défini</span>
                </ng-template>
            </div>
        </div>
        <div class="flex flex-row gap-2 items-center min-w-0">
            <!-- <lucide-icon name="Users" class="text-[#003863] w-4" /> -->
            <div class="flex flex-row gap-1 min-w-0 truncate">
                <span class="font-semibold">Stockage:</span>
                <ng-container *ngIf="machine.tailleStockage !== undefined && machine.tailleStockage !== null">
                    <ng-container *ngIf="machine.typeStockage; else justStorage">
                        {{machine.tailleStockage}} Go - {{machine.typeStockage}}
                    </ng-container>
                    <ng-template #justStorage>
                        {{machine.tailleStockage}} Go
                    </ng-template>
                </ng-container>
                <ng-container *ngIf="machine.tailleStockage === undefined || machine.tailleStockage === null">
                    <span class="text-gray-400">Non défini</span>
                </ng-container>
            </div>
        </div>
    </div>
    <div class="w-0.5 my-2 bg-[#B7CBDB] rounded-full flex-shrink-0"></div>
    <div class="flex flex-col gap-2 w-1/3 min-w-0 pt-10 px-4 pb-4 overflow-hidden">
        <div class="flex flex-row gap-2 items-center min-w-0">
            <lucide-icon name="banknote" class="text-[#003863] w-4" />
            <div class="flex flex-row gap-1 min-w-0 truncate">
                <span class="font-semibold">Achat:</span>
                <ng-container *ngIf="machine.dateAchat; else noDateAchat">
                    {{machine.dateAchat | date:'dd/MM/yyyy'}}
                </ng-container>
                <ng-template #noDateAchat>
                    <span class="text-gray-400">Date non renseignée</span>
                </ng-template>
            </div>
        </div>
        <div class="flex flex-row gap-2 items-center min-w-0">
            <lucide-icon name="receipt-text" class="text-[#003863] w-4" />
            <div class="flex flex-row gap-1 min-w-0 truncate">
                <span class="font-semibold">Garantie:</span>
                <ng-container *ngIf="machine.dateExpirationGarantie; else noDateExp">
                    {{machine.dateExpirationGarantie | date:'dd/MM/yyyy'}}
                </ng-container>
                <ng-template #noDateExp>
                    <span class="text-gray-400">Date non renseignée</span>
                </ng-template>
            </div>
        </div>
        <div class="flex flex-row gap-2 items-center min-w-0">
            <lucide-icon name="barcode" class="text-[#003863] w-4" />
            <div class="flex flex-row gap-1 min-w-0 truncate"><span
                    class="font-semibold">Vendeur:</span>{{machine.vendeur}}</div>
        </div>
        <div *ngIf="machine.commentaire && machine.commentaire.trim().length > 0"
            class="flex flex-row gap-2 items-center min-w-0">
            <lucide-icon name="sticky-note" class="text-[#003863] w-4 flex-shrink-0 self-start" />
            <button
                class="flex flex-row gap-1 items-center overflow-hidden text-ellipsis cursor-pointer hover:underline rounded transition min-w-0"
                (click)="openCommentModal(machine.commentaire)">
                <span class="font-semibold">Commentaire:</span>
                <span class="truncate min-w-0 block w-40">{{machine.commentaire}}</span>
            </button>
        </div>
    </div>
    <div class="w-0.5 my-2 bg-[#B7CBDB] rounded-full flex-shrink-0"></div>

    <div class="flex flex-col w-20 pt-4 min-w-0 justify-between items-center h-full">
        <div class="flex flex-col items-center mt-2 gap-1">
            <button (click)="editMachine(machine)"
                class="hover:bg-[#b5dfff] hover:opacity-100 rounded-full p-2 transition">
                <lucide-icon name="pencil" [size]="22" class="text-[#003863]" />
            </button>
            <button (click)="deleteMachine(machine.id)"
                class="hover:bg-[#ffc8b5] hover:opacity-100 rounded-full p-2 transition">
                <lucide-icon name="trash-2" [size]="22" class="text-[#c71509]" />
            </button>
        </div>
        <div class="flex flex-col items-center mt-8">
            <button class="hover:bg-orange-200 hover:opacity-80 rounded-full p-2 transition"
                (click)="openDialogue(machine.id)">
                <lucide-icon name="history" [size]="22" class="text-orange-500" />
            </button>
        </div>
    </div>
    <!--Responsive suggestions (see components-test)-->
</div>

<!-- Custom Modal for Commentaire -->
<!-- <div *ngIf="showCommentModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40">
    <div class="bg-white rounded-lg shadow-lg p-6 max-w-lg w-full">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-bold">Commentaire</h2>
            <button class="text-gray-500 hover:text-gray-700" (click)="closeCommentModal()">&times;</button>
        </div>
        <div class="text-gray-800 whitespace-pre-line">{{selectedCommentaire}}</div>
    </div>
</div> -->
<div *ngIf="showCommentModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40">
    <div class="bg-white rounded-lg shadow-lg p-6 max-w-lg w-full">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-[#024a97]">
                Commentaire
            </h2>
            <button
                class="text-gray-400 hover:bg-red-100 hover:text-red-600 transition-colors rounded-full p-1 focus:outline-none focus:ring-2 focus:ring-red-600"
                (click)="closeCommentModal()" aria-label="Fermer">
                <lucide-angular name="x" [size]="25" />
            </button>
        </div>
        <div class="font-medium text-gray-800 whitespace-pre-line break-words">{{selectedCommentaire}}</div>
    </div>
</div>