<div class="flex flex-row gap-0 bg-gray-100 rounded-lg overflow-hidden w-full  border border-gray-300">
    <div class="flex flex-col w-1/3 min-w-0 justify-center p-4 overflow-hidden">
        <div class="border-0 border-red-400">
            <div class="bg-[#003863] text-sm text-white w-fit px-2 py-1 rounded-lg shadow-lg font-medium">
                {{machine.type}}
            </div>
        </div>
        <!--       <div class="flex flex-col col-span-2 w-full border-0 border-red-400">
            <img class="w-20" src="../../../../../assets/images/desktop_low.png">
        </div> -->
        <!--------------------------------------------------------------------------------------------->
        <div class="flex flex-row">
            <div class="flex w-28 m-2 border-0 border-red-400">
                <ng-container [ngSwitch]="machine.type.toLowerCase()">
                    <img *ngSwitchCase="'desktop'" class="" src="../../../../../assets/images/desktop_low.png"
                        alt="Desktop" />
                    <img *ngSwitchCase="'laptop'" class="" src="../../../../../assets/images/Laptop_low.png"
                        alt="Laptop" />
                    <img *ngSwitchCase="'workstation'" class="" src="../../../../../assets/images/workstation_low.png"
                        alt="Workstation" />
                    <img *ngSwitchDefault class="w-20" src="../../../../../assets/images/web-icon-placeholder-3.svg"
                        alt="Default" />
                </ng-container>
            </div>
            <div class="flex flex-col gap-1 h-full border-0 border-red-400 min-w-0 w-full">
                <div class="flex flex-row font-semibold justify-between items-center min-w-0">
                    <div class="flex min-w-0 truncate">{{machine.marque |
                        uppercase}}</div>
                    <div class="flex flex-col text-right min-w-0 truncate">
                        {{machine.reseau}}</div>
                </div>
                <div class="text-3xl font-semibold min-w-0 truncate">
                    {{machine.modele}}</div>
                <div class="font-bold min-w-0 truncate">
                    {{machine.serviceTag}}</div>
            </div>
        </div>

        <!--------------------------------------------------------------------------------------------->
        <!--         <div class="flex flex-col col-span-2 h-full border-0 border-red-400 items-end text-right font-bold">
            {{machine.reseau}}
        </div> -->
        <div class="flex flex-col border-0 border-red-400 min-w-0 ">
            <div class="flex flex-row gap-2 items-center min-w-0">
                <lucide-icon name="user" class="text-[#003863] w-4" />
                <div class="flex flex-row gap-1 min-w-0 truncate"><span class="font-semibold">Assigné
                        à:</span>{{machine.assignedUser}}</div>
            </div>
            <div class="flex flex-row gap-2 items-center min-w-0">
                <lucide-icon name="map-pin" class="text-red-600 w-4" />
                <div class="flex flex-row gap-1 font-semibold min-w-0 truncate">{{machine.locationName}}</div>
            </div>
        </div>
    </div>
    <div class="w-0.5 my-2 bg-[#B7CBDB] rounded-full "></div>
    <div class="flex flex-col gap-2 w-1/3 min-w-0 pt-10 px-4 pb-4 overflow-hidden">
        <div class="flex flex-row gap-2 items-center min-w-0">
            <!--  <lucide-icon name="Users" class="text-[#003863] w-4" /> -->
            <div class="flex flex-row gap-1 min-w-0 truncate">
                <span class="font-semibold">OS:</span>
                <ng-container *ngIf="machine.os && machine.os.length > 50; else shortOs">
                    <button class="truncate min-w-0 hover:underline cursor-pointer text-left"
                        (click)="openCommentModal(machine.os, 'Système exploitation')">
                        {{machine.os}}
                    </button>
                </ng-container>
                <ng-template #shortOs>
                    {{machine.os}}
                </ng-template>
            </div>
        </div>
        <div class="flex flex-row gap-2 items-center min-w-0">
            <!-- <lucide-icon name="Users" class="text-[#003863] w-4" /> -->
            <div class="flex flex-row gap-1 min-w-0 truncate">
                <span class="font-semibold">CPU:</span>
                <ng-container *ngIf="machine.cpu && machine.cpu.length > 50; else shortCpu">
                    <button class="truncate min-w-0 hover:underline cursor-pointer text-left"
                        (click)="openCommentModal(machine.cpu, 'Processeur')">
                        {{machine.cpu}}
                    </button>
                </ng-container>
                <ng-template #shortCpu>
                    {{machine.cpu}}
                </ng-template>
            </div>
        </div>
        <div class="flex flex-row gap-2 items-center min-w-0">
            <!-- <lucide-icon name="Users" class="text-[#003863] w-4" /> -->
            <div class="flex flex-row gap-1 min-w-0 truncate"><span class="font-semibold">RAM:</span>{{machine.ram}} Go
            </div>
        </div>
        <div class="flex flex-row gap-2 items-center min-w-0">
            <!-- <lucide-icon name="Users" class="text-[#003863] w-4" /> -->
            <div class="flex flex-row gap-1 min-w-0 truncate"><span
                    class="font-semibold">Stockage:</span>{{machine.typeStockage}} - {{machine.tailleStockage}} Go</div>
        </div>
    </div>
    <div class="w-0.5 my-2 bg-[#B7CBDB] rounded-full flex-shrink-0"></div>
    <div class="flex flex-col gap-2 w-1/3 min-w-0 pt-10 px-4 pb-4 overflow-hidden">
        <div class="flex flex-row gap-2 items-center min-w-0">
            <lucide-icon name="banknote" class="text-[#003863] w-4" />
            <div class="flex flex-row gap-1 min-w-0 truncate"><span
                    class="font-semibold">Achat:</span>{{machine.dateAchat | date}}</div>
        </div>
        <div class="flex flex-row gap-2 items-center min-w-0">
            <lucide-icon name="receipt-text" class="text-[#003863] w-4" />
            <div class="flex flex-row gap-1 min-w-0 truncate"><span
                    class="font-semibold">Garantie:</span>{{machine.dateExpirationGarantie | date}}</div>
        </div>
        <div class="flex flex-row gap-2 items-center min-w-0">
            <lucide-icon name="barcode" class="text-[#003863] w-4" />
            <div class="flex flex-row gap-1 min-w-0 truncate"><span
                    class="font-semibold">Vendeur:</span>{{machine.vendeur}}</div>
        </div>
        <!--         <div class="flex flex-row gap-2 items-center min-w-0">
            <lucide-icon name="sticky-note" class="text-[#003863] w-4 flex-shrink-0 self-start" />
            <button
                class="flex flex-row gap-1 items-center overflow-hidden text-ellipsis cursor-pointer hover:underline rounded transition min-w-0"
                (click)="openCommentModal(machine.commentaire)">
                <span class="font-semibold">Commentaire:</span>
                <span class="truncate min-w-0 block w-40">{{machine.commentaire}}</span>
            </button>
        </div> -->
        <div *ngIf="machine.commentaire && machine.commentaire.trim().length > 0"
            class="flex flex-row gap-2 items-center min-w-0">
            <lucide-icon name="sticky-note" class="text-[#003863] w-4 flex-shrink-0" />
            <div class="flex flex-row gap-1 min-w-0 truncate">
                <span class="font-semibold hover:underline cursor-pointer"
                    (click)="openCommentModal(machine.commentaire, 'Commentaire')">Commentaire:</span>
                <button class="truncate min-w-0 hover:underline cursor-pointer text-left"
                    (click)="openCommentModal(machine.commentaire, 'Commentaire')">
                    {{ machine.commentaire.length > 50 ? (machine.commentaire | slice:0:50) + '...' :
                    machine.commentaire }}
                </button>
            </div>
        </div>
    </div>
    <div class="w-0.5 my-2 bg-[#B7CBDB] rounded-full flex-shrink-0"></div>
    <div class="flex flex-col w-20 my-8 min-w-0">
        <div class="flex flex-col gap-3 h-1/2 items-center">
            <button (click)="restoreMachine(machine.id)"
                class="hover:bg-green-200 hover:opacity-80 rounded-full p-2 transition">
                <lucide-icon name="rotate-ccw" [size]="22" class="text-green-600" />
            </button>
        </div>
        <div class=" flex flex-col h-1/2 items-center justify-end">
            <button class="hover:bg-orange-200 hover:opacity-80 rounded-full p-2 transition">
                <lucide-icon name="history" [size]="22" class="text-orange-500" (click)="openDialogue(machine.id)" />
            </button>
        </div>
    </div>
    <!--Responsive suggestions (see components-test)-->
</div>

<!-- Custom Modal for Commentaire -->
<!-- <div *ngIf="showCommentModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40">
    <div class="bg-white rounded-lg shadow-lg p-6 max-w-lg w-full">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-bold">Commentaire</h2>
            <button class="text-gray-500 hover:text-gray-700" (click)="closeCommentModal()">&times;</button>
        </div>
        <div class="text-gray-800 whitespace-pre-line">{{selectedCommentaire}}</div>
    </div>
</div> -->
<div *ngIf="showCommentModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40">
    <div class="bg-white rounded-lg shadow-lg p-6 max-w-lg w-full">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-[#024a97]">
                {{modalTitle}}
            </h2>
            <button
                class="text-gray-400 hover:bg-red-100 hover:text-red-600 transition-colors rounded-full p-1 focus:outline-none focus:ring-2 focus:ring-red-600"
                (click)="closeCommentModal()" aria-label="Fermer">
                <lucide-angular name="x" [size]="25" />
            </button>
        </div>
        <div class="font-medium text-gray-800 whitespace-pre-line break-words">{{selectedCommentaire}}</div>
    </div>
</div>